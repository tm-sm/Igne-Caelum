[gd_scene load_steps=10 format=2]

[ext_resource path="res://ui/VHS_shader.tres" type="Material" id=1]
[ext_resource path="res://ui/GUI_theme.tres" type="Theme" id=2]
[ext_resource path="res://fonts/VCR_OSD_MONO_1.001.ttf" type="DynamicFontData" id=3]
[ext_resource path="res://sounds/lock_on.ogg" type="AudioStream" id=4]
[ext_resource path="res://sounds/missile_warning.ogg" type="AudioStream" id=5]

[sub_resource type="GDScript" id=7]
script/source = "extends CanvasLayer


var data

#Info tab
onready var speed_value = $Info/FlightInfo/Speed/Value
onready var thrust_value = $Info/FlightInfo/Thrust/Value

#Weapons Info
onready var mg_ammo_value = $InfoWeapons/InfoWeapons/MachineGun/Value
onready var msl_ammo_value = $InfoWeapons/InfoWeapons/Missile/Value
onready var flr_ammo_value = $InfoWeapons/InfoWeapons/Flares/Value

#Weapon states
onready var lock_warning = $Weapons/WeaponSensors/TargetLockLabel
onready var lock_sound = $LockOnSound

#Warnings
onready var missile_warning = $Warning/WarningSensors/LockedOnLabel
onready var missile_warning_sound = $MissileWarning


var gathering_data

func initialize(dt):
	data = dt
	data.connect(\"destroyed\", self, \"_on_data_source_destroyed\")
	gathering_data = true

func _process(_delta):
	if gathering_data:
		speed_value.text = str(stepify(data.forward_speed / 2, 0.01)) + \"km/h\"
		thrust_value.text = str(data.engine_thrust_percentage * 100) + \"%\"
		mg_ammo_value.text = str(data.get_machinegun().ammo)
		msl_ammo_value.text = str(data.get_missile_launcher().ammo)
		flr_ammo_value.text = str(data.get_flare_dispenser().ammo)
		
		
		if data.get_missile_sensor():
			lock_warning.text = \"TRGT LOCK\"
			if not lock_sound.playing:
				lock_sound.play(0)
		else:
			lock_warning.text = \"\"
			lock_sound.stop()
		if data.locked_on_by_missile:
			missile_warning.text = \"WARNING MISSILE\"
			if not missile_warning_sound.playing:
				missile_warning_sound.play(0)
		else:
			missile_warning.text = \"\"
			missile_warning_sound.stop()

func _on_data_source_destroyed():
	gathering_data = false
	missile_warning_sound.stop()
	lock_sound.stop()
	speed_value.text = \"N/A\"
	thrust_value.text = \"N/A\"
	lock_warning.text = \"\"
	missile_warning.text = \"CONNECTION LOST\"
	mg_ammo_value.text = \"N/A\"
	msl_ammo_value.text = \"N/A\"
	flr_ammo_value.text = \"N/A\"
"

[sub_resource type="DynamicFont" id=41]
size = 30
outline_color = Color( 0, 0, 0, 1 )
use_filter = true
extra_spacing_char = 2
font_data = ExtResource( 3 )

[sub_resource type="DynamicFont" id=42]
size = 30
outline_color = Color( 0, 0, 0, 1 )
use_filter = true
extra_spacing_char = 2
font_data = ExtResource( 3 )

[sub_resource type="GDScript" id=43]
script/source = "extends Label


onready var timer = $Timer


func _on_Timer_timeout():
	visible = not visible
"

[node name="GUI" type="CanvasLayer"]
layer = 0
script = SubResource( 7 )

[node name="Info" type="PanelContainer" parent="."]
margin_left = 50.0
margin_top = 50.0
margin_right = 300.0
margin_bottom = 200.0
theme = ExtResource( 2 )

[node name="FlightInfo" type="VBoxContainer" parent="Info"]
margin_right = 250.0
margin_bottom = 150.0

[node name="Speed" type="HBoxContainer" parent="Info/FlightInfo"]
margin_right = 250.0
margin_bottom = 18.0

[node name="Type" type="Label" parent="Info/FlightInfo/Speed"]
margin_right = 54.0
margin_bottom = 18.0
text = "SPD:"

[node name="Value" type="Label" parent="Info/FlightInfo/Speed"]
margin_left = 58.0
margin_right = 98.0
margin_bottom = 18.0
text = "N/A"

[node name="Thrust" type="HBoxContainer" parent="Info/FlightInfo"]
margin_top = 22.0
margin_right = 250.0
margin_bottom = 40.0

[node name="Type" type="Label" parent="Info/FlightInfo/Thrust"]
margin_right = 54.0
margin_bottom = 18.0
text = "THR:"

[node name="Value" type="Label" parent="Info/FlightInfo/Thrust"]
margin_left = 58.0
margin_right = 98.0
margin_bottom = 18.0
text = "N/A"

[node name="InfoWeapons" type="PanelContainer" parent="."]
anchor_left = 1.0
anchor_right = 1.0
margin_left = -50.0
margin_top = 50.0
margin_right = -50.0
margin_bottom = -300.0
grow_horizontal = 0
theme = ExtResource( 2 )

[node name="InfoWeapons" type="VBoxContainer" parent="InfoWeapons"]
margin_right = 98.0
margin_bottom = 62.0

[node name="MachineGun" type="HBoxContainer" parent="InfoWeapons/InfoWeapons"]
margin_right = 98.0
margin_bottom = 18.0

[node name="Type" type="Label" parent="InfoWeapons/InfoWeapons/MachineGun"]
margin_right = 54.0
margin_bottom = 18.0
text = "MGN:"

[node name="Value" type="Label" parent="InfoWeapons/InfoWeapons/MachineGun"]
margin_left = 58.0
margin_right = 98.0
margin_bottom = 18.0
text = "N/A"

[node name="Missile" type="HBoxContainer" parent="InfoWeapons/InfoWeapons"]
margin_top = 22.0
margin_right = 98.0
margin_bottom = 40.0

[node name="Type" type="Label" parent="InfoWeapons/InfoWeapons/Missile"]
margin_right = 54.0
margin_bottom = 18.0
text = "MSL:"

[node name="Value" type="Label" parent="InfoWeapons/InfoWeapons/Missile"]
margin_left = 58.0
margin_right = 98.0
margin_bottom = 18.0
text = "N/A"

[node name="Flares" type="HBoxContainer" parent="InfoWeapons/InfoWeapons"]
margin_top = 44.0
margin_right = 98.0
margin_bottom = 62.0

[node name="Type" type="Label" parent="InfoWeapons/InfoWeapons/Flares"]
margin_right = 54.0
margin_bottom = 18.0
text = "FLR:"

[node name="Value" type="Label" parent="InfoWeapons/InfoWeapons/Flares"]
margin_left = 58.0
margin_right = 98.0
margin_bottom = 18.0
text = "N/A"

[node name="Weapons" type="PanelContainer" parent="."]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -67.0
margin_top = 43.0
margin_right = 67.0
margin_bottom = 65.0
grow_horizontal = 2
theme = ExtResource( 2 )

[node name="WeaponSensors" type="VBoxContainer" parent="Weapons"]
margin_right = 134.0
margin_bottom = 27.0
grow_horizontal = 2

[node name="TargetLockLabel" type="Label" parent="Weapons/WeaponSensors"]
margin_right = 134.0
margin_bottom = 27.0
grow_horizontal = 2
custom_colors/font_color = Color( 0.0196078, 0.219608, 1, 1 )
custom_fonts/font = SubResource( 41 )
align = 1
uppercase = true

[node name="Warning" type="PanelContainer" parent="."]
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -58.5
margin_top = -11.0
margin_right = 58.5
margin_bottom = 11.0
grow_horizontal = 2
theme = ExtResource( 2 )

[node name="WarningSensors" type="VBoxContainer" parent="Warning"]
margin_right = 298.0
margin_bottom = 27.0

[node name="LockedOnLabel" type="Label" parent="Warning/WarningSensors"]
margin_right = 298.0
margin_bottom = 27.0
custom_colors/font_color = Color( 0.996078, 0, 0, 1 )
custom_fonts/font = SubResource( 42 )
text = "WARNING MISSILE"
script = SubResource( 43 )

[node name="Timer" type="Timer" parent="Warning/WarningSensors/LockedOnLabel"]
wait_time = 0.258
autostart = true

[node name="Screen" type="ColorRect" parent="."]
material = ExtResource( 1 )
anchor_right = 1.0
anchor_bottom = 1.0
color = Color( 0, 0, 0, 1 )

[node name="MissileWarning" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 5 )

[node name="LockOnSound" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 4 )
volume_db = -10.0

[connection signal="timeout" from="Warning/WarningSensors/LockedOnLabel/Timer" to="Warning/WarningSensors/LockedOnLabel" method="_on_Timer_timeout"]
